<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주간 루틴 매니저</title>
    <meta name="description" content="요일별 생활계획표와 알림 기능이 있는 루틴 관리 앱">
    
    <!-- PWA 설정 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="주간 루틴">
    
    <!-- 스타일 시트 -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css" media="screen and (max-width: 768px)">
    
    <!-- 아이콘 (Font Awesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="container">
            <h1 class="app-title">
                <i class="fas fa-calendar-week"></i>
                주간 루틴 매니저
            </h1>
            <button class="notification-toggle" id="notificationToggle">
                <i class="fas fa-bell"></i>
                <span>알림 설정</span>
            </button>
        </div>
    </header>

    <!-- 메인 컨테이너 -->
    <main class="main-container">
        <div class="container">
            <!-- 요일 탭 -->
            <div class="day-tabs" id="dayTabs">
                <button class="day-tab active" data-day="monday">월</button>
                <button class="day-tab" data-day="tuesday">화</button>
                <button class="day-tab" data-day="wednesday">수</button>
                <button class="day-tab" data-day="thursday">목</button>
                <button class="day-tab" data-day="friday">금</button>
                <button class="day-tab" data-day="saturday">토</button>
                <button class="day-tab" data-day="sunday">일</button>
            </div>

            <!-- 현재 요일 스케줄 -->
            <div class="schedule-container">
                <div class="schedule-header">
                    <h2 class="current-day-title" id="currentDayTitle">월요일 스케줄</h2>
                    <button class="add-schedule-btn" id="addScheduleBtn">
                        <i class="fas fa-plus"></i>
                        스케줄 추가
                    </button>
                </div>

                <!-- 스케줄 리스트 -->
                <div class="schedule-list" id="scheduleList">
                    <!-- 스케줄 아이템들이 여기에 동적으로 추가됩니다 -->
                </div>

                <!-- 빈 상태 -->
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-calendar-plus"></i>
                    <p>아직 등록된 스케줄이 없습니다.</p>
                    <p>스케줄을 추가해보세요!</p>
                </div>
            </div>

            <!-- 통계 섹션 -->
            <div class="stats-section">
                <h3>이번 주 실행 현황</h3>
                <div class="stats-grid" id="statsGrid">
                    <!-- 통계 정보가 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </main>

    <!-- 스케줄 추가/수정 모달 -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">스케줄 추가</h3>
                <button class="close-btn" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="scheduleTime">시간</label>
                        <input type="time" id="scheduleTime" required>
                    </div>
                    <div class="form-group">
                        <label for="scheduleTitle">활동명</label>
                        <input type="text" id="scheduleTitle" placeholder="예: 운동, 독서, 요리..." required>
                    </div>
                    <div class="form-group">
                        <label for="scheduleDescription">설명 (선택사항)</label>
                        <textarea id="scheduleDescription" placeholder="상세 설명이나 메모..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableNotification">
                            <span class="checkmark"></span>
                            알림 받기
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">취소</button>
                        <button type="submit" class="btn btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 알림 권한 요청 모달 -->
    <div class="notification-modal" id="notificationModal">
        <div class="notification-content">
            <i class="fas fa-bell"></i>
            <h3>알림 허용</h3>
            <p>스케줄 알림을 받으시겠습니까?</p>
            <div class="notification-actions">
                <button class="btn btn-secondary" id="denyNotification">나중에</button>
                <button class="btn btn-primary" id="allowNotification">허용</button>
            </div>
        </div>
    </div>

    <!-- 디버그 패널 (개발 모드) -->
    <div class="debug-panel" id="debugPanel" style="display: none;">
        <div class="debug-header">
            <h4>🔧 알림 테스트</h4>
            <button class="debug-close" onclick="document.getElementById('debugPanel').style.display='none'">&times;</button>
        </div>
        <div class="debug-body">
            <button class="btn btn-primary" onclick="testNotification.showNow()" style="width: 100%; margin-bottom: 8px;">
                즉시 알림 테스트
            </button>
            <button class="btn btn-primary" onclick="testNotification.showIn5Seconds()" style="width: 100%; margin-bottom: 8px;">
                5초 후 알림
            </button>
            <button class="btn btn-primary" onclick="testNotification.showIn30Seconds()" style="width: 100%; margin-bottom: 8px;">
                30초 후 알림
            </button>
            <button class="btn btn-secondary" onclick="testNotification.checkPermission()" style="width: 100%; margin-bottom: 8px;">
                권한 상태 확인
            </button>
            <button class="btn btn-secondary" onclick="testNotification.listScheduled()" style="width: 100%; margin-bottom: 8px;">
                스케줄된 알림 보기
            </button>
            <div class="debug-info" id="debugInfo" style="margin-top: 12px; padding: 8px; background: #f3f4f6; border-radius: 4px; font-size: 12px;">
                콘솔(F12)에서 결과를 확인하세요
            </div>
        </div>
    </div>

    <!-- 디버그 패널 열기 버튼 -->
    <button class="debug-toggle" onclick="document.getElementById('debugPanel').style.display='block'" title="알림 테스트 패널">
        🔧
    </button>

    <!-- 자바스크립트 파일들 -->
    <script src="js/storage.js"></script>
    <script src="js/notification.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/app.js"></script>
    
    <!-- 서비스 워커 등록 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('✅ 서비스 워커 등록 성공:', registration.scope);
                    })
                    .catch(error => {
                        console.error('❌ 서비스 워커 등록 실패:', error);
                    });
            });
        }
    </script>
</body>
</html>